<template>
  <div class="index-smr-table-container">
    <table class="index-smr-table">
      <thead>
        <tr>
          <th class="index-column">
            <span class="animated-icon">‚ö°</span>
          </th>
          <th>–ö–æ—Ñ–µ–π–Ω—è</th>
          <th class="points-column">–¢–æ—á–∫–∏</th>
          <th>–û—Ç–∑—ã–≤—ã</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª</th>
          <th>–¢–∏–ø –∑–µ—Ä–Ω–∞</th>
          <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
          <th>–¢–∏–ø</th>
          <th>–°—Ç–∞–¥–∏—è</th>
          <th>–ò–Ω–Ω–æ–≤–∞—Ü–∏–∏</th>
          <th>–í–ª–∏—è–Ω–∏–µ</th>
          <th>–†–æ—Å—Ç</th>
        </tr>
      </thead>
      <tbody>
        <tr
          v-for="(coffee, idx) in sortedCoffeeData"
          :key="`${coffee.name}-${coffee.index}`"
          @click="setActiveRow(idx)"
          :class="{
            'golden-row': idx < 6,
            'out-of-game-separator': isFirstOutOfGame(coffee, idx),
            'active-row': activeRowIndex === idx
          }"
        >
          <td class="cell-center index-column">{{ coffee.index }}</td>
          <td class="cell-left nowrap">
            <span :class="iconClass(coffee.icon)">{{ coffee.icon }}</span>
            {{ coffee.name }}
          </td>
          <td class="cell-left points-column">
            {{ coffee.points }}
            <span v-if="coffee.scale !== '¬∑'" class="scale-text"> ({{ coffee.scale }})</span>
            <span v-else class="stagnation-dot">¬∑</span>
          </td>
          <td class="cell-left">{{ coffee.reviews }}</td>
          <td class="cell-nowrap">
            <span class="badge" :class="statusClass(coffee.status)">
              {{ coffee.status }}
            </span>
          </td>
          <td class="cell-left">
            <span class="badge" :class="potentialClass(coffee.potential)">
              {{ coffee.potential }} {{ potentialEmoji(coffee.potential) }}
            </span>
          </td>
          <td class="cell-left">
            <span class="badge" :class="beanTypeClass(coffee.beanType)">
              {{ coffee.beanType }}
            </span>
          </td>
          <td class="cell-left supplier-cell">
            <span v-for="name in getCleanedSuppliers(coffee.supplier)" :key="name" class="badge badge-supplier">
              {{ name }}
            </span>
          </td>
          <td class="cell-left">
            <span class="badge" :class="typeClass(coffee.type)">
              {{ coffee.type }}
            </span>
          </td>
          <td class="cell-left">
            <span class="badge" :class="stageClass(coffee.stage)">
              {{ coffee.stage }}
            </span>
          </td>
          <td class="cell-left">
            <span class="badge" :class="innovationClass(coffee.innovation)">
              {{ coffee.innovation }}
            </span>
          </td>
          <td class="cell-left">
            <span class="badge" :class="influenceClass(coffee.influence)">
              {{ coffee.influence }}
            </span>
          </td>
          <td class="cell-left">
            <span class="badge" :class="growthClass(coffee.growth)">
              {{ coffee.growth }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</template>

<script>
export default {
  name: 'IndexSMR',
  data() {
    return {
      activeRowIndex: null,
      statusOrder: [
        '–õ–∏–¥–µ—Ä üëë',
        '–°–∏–ª—å–Ω—ã–π üí™', 
        '–†–∞—Å—Ç—É—â–∏–π üìà',
        '–°—Ç–∞–±–∏–ª—å–Ω—ã–π üéØ',
        '–í–Ω–µ –∏–≥—Ä—ã üö´'
      ],
      coffeeData: [
        // –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–¥–µ—Å—å...
      ]
    }
  },
  computed: {
    sortedCoffeeData() {
      return [...this.coffeeData].sort((a, b) => {
        const statusOrderA = this.statusOrder.indexOf(a.status);
        const statusOrderB = this.statusOrder.indexOf(b.status);
        if (statusOrderA !== statusOrderB) {
          return statusOrderA - statusOrderB;
        }
        return b.index - a.index;
      });
    }
  },
  methods: {
    setActiveRow(index) {
      this.activeRowIndex = this.activeRowIndex === index ? null : index;
    },
    iconClass(icon) {
      if (icon === 'üü°') return 'icon-yellow';
      if (icon === 'üî¥') return 'icon-red';
      if (icon === 'üü¢') return 'icon-green';
      return '';
    },
    statusClass(status) {
      if (status === '–õ–∏–¥–µ—Ä üëë') return 'status-leader';
      if (status === '–°–∏–ª—å–Ω—ã–π üí™') return 'status-strong';
      if (status === '–†–∞—Å—Ç—É—â–∏–π üìà') return 'status-growing';
      if (status === '–°—Ç–∞–±–∏–ª—å–Ω—ã–π üéØ') return 'status-stable';
      if (status === '–í–Ω–µ –∏–≥—Ä—ã üö´') return 'status-out';
      return '';
    },
    beanTypeClass(beanType) {
      if (beanType === '–°–≤–æ–π –±—Ä–µ–Ω–¥ üè∑Ô∏è') return 'bean-own-brand';
      if (beanType === '–ö–æ–º–º–µ—Ä—Ü–∏—è üì¶') return 'bean-commercial';
      if (beanType === '–°–ø–µ—à–µ–ª—Ç–∏ ‚≠ê') return 'bean-specialty';
      if (beanType === '–ë–µ–∑ –±—Ä–µ–Ω–¥–∞ ‚ö™') return 'bean-no-brand';
      if (beanType === '–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç üß™') return 'bean-experiment';
      return 'bean-default';
    },
    typeClass(type) {
      if (type === '–ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è') return 'param-independent';
      if (type === '–°–µ—Ç—å') return 'param-network';
      if (type === '–§—Ä–∞–Ω—à–∏–∑–∞') return 'param-franchise';
      if (type === '–õ–æ–∫–∞–ª—å–Ω–∞—è') return 'param-local';
      return 'param-default';
    },
    potentialClass(potential) {
      if (potential === '–í—ã—Å–æ–∫–∏–π') return 'param-high';
      if (potential === '–°—Ä–µ–¥–Ω–∏–π') return 'param-medium';
      if (potential === '–ù–∏–∑–∫–∏–π') return 'param-low';
      return 'param-default';
    },
    stageClass(stage) {
      if (stage === '–≠–∫—Å–ø–∞–Ω—Å–∏—è') return 'param-expansion';
      if (stage === '–†–æ—Å—Ç') return 'param-growth';
      if (stage === '–ó—Ä–µ–ª–æ—Å—Ç—å') return 'param-mature';
      if (stage === '–°—Ç–∞—Ä—Ç–∞–ø') return 'param-startup';
      return 'param-default';
    },
    innovationClass(innovation) {
      if (innovation === '–í—ã—Å–æ–∫–∞—è') return 'param-high';
      if (innovation === '–°—Ä–µ–¥–Ω—è—è') return 'param-medium';
      if (innovation === '–ù–∏–∑–∫–∞—è') return 'param-low';
      return 'param-default';
    },
    influenceClass(influence) {
      if (influence === '–í—ã—Å–æ–∫–æ–µ') return 'param-high';
      if (influence === '–°—Ä–µ–¥–Ω–µ–µ') return 'param-medium';
      if (influence === '–ù–∏–∑–∫–æ–µ') return 'param-low';
      return 'param-default';
    },
    growthClass(growth) {
      if (growth === '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π') return 'param-very-high';
      if (growth === '–í—ã—Å–æ–∫–∏–π') return 'param-high';
      if (growth === '–°—Ä–µ–¥–Ω–∏–π') return 'param-medium';
      if (growth === '–ù–∏–∑–∫–∏–π') return 'param-low';
      return 'param-default';
    },
    isFirstOutOfGame(coffee, index) {
      return coffee.status === '–í–Ω–µ –∏–≥—Ä—ã üö´' && 
             (index === 0 || this.sortedCoffeeData[index - 1].status !== '–í–Ω–µ –∏–≥—Ä—ã üö´');
    },
    potentialEmoji(potential) {
      if (potential === '–í—ã—Å–æ–∫–∏–π') return 'üöÄ';
      if (potential === '–ù–∏–∑–∫–∏–π') return 'üå±';
      if (potential === '–°—Ä–µ–¥–Ω–∏–π') return '‚ú®';
      return '';
    },
    getCleanedSuppliers(supplier) {
      const names = supplier.split(/, |,/g);
      return names.map(name => {
        let cleaned = name.replace(/\(–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–∞—è –æ–±–∂–∞—Ä–∫–∞\)/gi, '').trim();
        cleaned = cleaned.replace(/\s*\([^\)]*\)/gi, '').trim();
        if (cleaned === '–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –æ–±–∂–∞—Ä–∫–∞') {
          return '–°–≤–æ—è –æ–±–∂–∞—Ä–∫–∞';
        }
        return cleaned;
      });
    }
  }
}
</script>

<style scoped>
.index-smr-table-container {
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.index-smr-table {
  width: 100%;
  border-spacing: 0;
  border-collapse: separate;
  table-layout: fixed;
}

/* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
.index-smr-table th {
  background: var(--vp-c-bg-soft, #222);
  text-transform: uppercase;
  font-size: 13px;
  font-weight: 700;
  letter-spacing: 1px;
  color: var(--vp-c-text-2, #888);
  border-bottom: 1px solid var(--vp-c-divider, #333);
  padding: 12px 10px;
  white-space: nowrap;
  vertical-align: middle;
}

.index-smr-table th a {
  color: inherit; text-decoration: underline; text-decoration-style: dashed;
  text-decoration-thickness: 1px; text-underline-offset: 3px; font-weight: 700;
  transition: all 0.2s ease;
}
.index-smr-table th a:hover { color: var(--vp-c-brand-1, #646cff); text-decoration-style: solid; }
.index-smr-table th a:visited { color: inherit; }

.index-column { width: 60px; text-align: center; }
.points-column { white-space: nowrap; font-weight: 600; width: 100px; }
.nowrap { white-space: nowrap !important; }

.animated-icon {
  display: inline-block;
  font-size: 1.2em;
  animation: pulse 2.5s infinite;
  transition: transform 0.3s ease;
}
@keyframes pulse {
  0% { transform: scale(1); text-shadow: 0 0 5px rgba(255, 255, 0, 0); }
  50% { transform: scale(1.1); text-shadow: 0 0 10px rgba(255, 193, 7, 0.7); }
  100% { transform: scale(1); text-shadow: 0 0 5px rgba(255, 255, 0, 0); }
}
.index-smr-table th:hover .animated-icon {
  transform: scale(1.2);
}

/* –Ø—á–µ–π–∫–∏ */
.index-smr-table td {
  padding: 10px 8px;
  border-bottom: 1px solid var(--vp-c-divider, #333);
  font-size: 15px;
  background: none;
  transition: background 0.14s;
  color: var(--vp-c-text-1, #e6e6e6);
  vertical-align: middle;
}
.index-smr-table td:nth-child(2) { font-weight: 600; }

.index-smr-table tbody tr {
  cursor: pointer;
  transition: box-shadow 0.2s ease-in-out, background 0.2s;
}

/* Active row –≤—ã–¥–µ–ª–µ–Ω–∏–µ */
.active-row {
  background: rgba(197, 249, 70, 0.09) !important;
  box-shadow: 0 2px 0 0 #c5f946, 0 -2px 0 0 #c5f946;
}
.active-row td {
  background: rgba(197, 249, 70, 0.09) !important;
}

.index-smr-table tbody tr:hover td {
  background: rgba(120,120,120,0.12);
}

.golden-row {
  background: linear-gradient(90deg,rgba(255,230,90,0.05) 0%,rgba(255,226,120,0.0) 100%);
}
.active-row.golden-row td {
  background: linear-gradient(90deg, rgba(255,230,90,0.1) 0%, rgba(197, 249, 70, 0.05) 100%) !important;
}

.out-of-game-separator td { border-top: 4px solid #ff6b6b !important; padding-top: 14px; }

.cell-center { text-align: center; }
.cell-left { text-align: left; }
.cell-nowrap { white-space: nowrap; }
.supplier-cell { line-height: 1.6; }

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
.scale-text { font-size: 0.9em; color: #888; }
.stagnation-dot { font-weight: 900; font-size: 1.5em; line-height: 1; vertical-align: middle; color: #888; padding-left: 4px; }

.icon-yellow { color: #fbbf24; font-weight: bold; }
.icon-red { color: #dc2626; font-weight: bold; }
.icon-green { color: #22c55e; font-weight: bold; }

/* --- –°–¢–ò–õ–ò –ë–ï–ô–î–ñ–ï–ô --- */
.badge {
  display: inline-block;
  border-radius: 6px;
  padding: 4px 10px;
  font-size: 0.85em;
  white-space: nowrap;
  vertical-align: baseline;
  margin: 2px;
  font-weight: 500;
  letter-spacing: 0.02em;
  border: 1px solid transparent;
}

.status-leader { background: rgba(197, 249, 70, 0.15); color: #c5f946; border-color: rgba(197, 249, 70, 0.3); }
.status-strong { background: rgba(59, 130, 246, 0.15); color: #60a5fa; border-color: rgba(59, 130, 246, 0.3); }
.status-growing { background: rgba(34, 197, 94, 0.15); color: #4ade80; border-color: rgba(34, 197, 94, 0.3); }
.status-stable { background: rgba(156, 163, 175, 0.15); color: #9ca3af; border-color: rgba(156, 163, 175, 0.3); }
.status-out { background: rgba(255, 107, 107, 0.15); color: #ff6b6b; border-color: rgba(255, 107, 107, 0.3); }

.bean-own-brand { background: rgba(245, 158, 11, 0.15); color: #f59e0b; border-color: rgba(245, 158, 11, 0.3); }
.bean-commercial { background: rgba(99, 102, 241, 0.15); color: #818cf8; border-color: rgba(99, 102, 241, 0.3); }
.bean-specialty { background: rgba(16, 185, 129, 0.15); color: #34d399; border-color: rgba(16, 185, 129, 0.3); }
.bean-no-brand { background: rgba(107, 114, 128, 0.15); color: #9ca3af; border-color: rgba(107, 114, 128, 0.3); }
.bean-experiment { background: rgba(236, 72, 153, 0.15); color: #f472b6; border-color: rgba(236, 72, 153, 0.3); }

.badge-supplier { background: rgba(107, 114, 128, 0.1); color: #a0a0a0; border-color: rgba(107, 114, 128, 0.2); }

.param-independent { background: rgba(197, 249, 70, 0.1); color: rgba(197, 249, 70, 0.9); border-color: rgba(197, 249, 70, 0.2); }
.param-network { background: rgba(59, 130, 246, 0.1); color: rgba(96, 165, 250, 0.9); border-color: rgba(59, 130, 246, 0.2); }
.param-franchise { background: rgba(168, 85, 247, 0.15); color: rgba(192, 132, 252, 1); border-color: rgba(168, 85, 247, 0.3); }
.param-local { background: rgba(107, 114, 128, 0.15); color: rgba(156, 163, 175, 1); border-color: rgba(107, 114, 128, 0.25); }

.param-very-high, .param-high, .badge.param-high { background: rgba(34, 197, 94, 0.15); color: rgba(52, 211, 153, 1); border-color: rgba(34, 197, 94, 0.3); }
.param-medium, .badge.param-medium { background: rgba(234, 179, 8, 0.15); color: rgba(252, 211, 77, 1); border-color: rgba(234, 179, 8, 0.3); }
.param-low, .badge.param-low { background: rgba(239, 68, 68, 0.15); color: rgba(248, 113, 113, 1); border-color: rgba(239, 68, 68, 0.3); }

.param-expansion { background: rgba(59, 130, 246, 0.1); color: rgba(96, 165, 250, 0.9); border-color: rgba(59, 130, 246, 0.2); }
.param-growth { background: rgba(34, 197, 94, 0.1); color: rgba(52, 211, 153, 0.9); border-color: rgba(34, 197, 94, 0.2); }
.param-mature { background: rgba(156, 163, 175, 0.15); color: rgba(156, 163, 175, 1); border-color: rgba(156, 163, 175, 0.25); }
.param-startup { background: rgba(168, 85, 247, 0.1); color: rgba(192, 132, 252, 0.9); border-color: rgba(168, 85, 247, 0.2); }
.param-default { background: rgba(107, 114, 128, 0.1); color: rgba(107, 114, 128, 0.9); border-color: rgba(107, 114, 128, 0.2); }

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1024px) {
  .index-smr-table th, .index-smr-table td { font-size: 13px; }
  .index-smr-table { min-width: 1100px; }
  .badge { font-size: 0.8em; padding: 3px 8px; }
}
@media (max-width: 760px) {
  .index-smr-table th, .index-smr-table td { font-size: 12px; }
  .index-smr-table { min-width: 820px; }
  .badge { font-size: 0.75em; padding: 2px 6px; }
}
@media (max-width: 480px) {
  .index-smr-table th, .index-smr-table td { font-size: 11px; }
  .index-smr-table { min-width: 760px; }
  .badge { font-size: 0.7em; padding: 1px 4px; }
}
</style>
